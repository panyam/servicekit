"use strict";
/**
 * TypedGRPCWSClient - Type-safe wrapper for GRPCWSClient.
 *
 * This wrapper provides compile-time type safety for protobuf messages.
 * Use with types generated by any TypeScript protoc plugin:
 * - @bufbuild/protobuf
 * - protobuf-ts
 * - ts-proto
 * - etc.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TypedGRPCWSClient = void 0;
const grpcws_client_1 = require("./grpcws-client");
/**
 * Type-safe gRPC-WebSocket client with generic input/output types.
 *
 * This wrapper enforces type safety at compile time by parameterizing
 * the send and receive message types. Use with your protobuf-generated
 * TypeScript types.
 *
 * @typeParam TIn - The type of messages sent to the server
 * @typeParam TOut - The type of messages received from the server
 *
 * @example With @bufbuild/protobuf types
 * ```typescript
 * import { PlayerAction, GameState } from './gen/game_pb';
 *
 * const client = new TypedGRPCWSClient<PlayerAction, GameState>();
 * client.onMessage = (state: GameState) => {
 *   console.log('Players:', state.players);
 * };
 * await client.connect('ws://localhost:8080/ws/v1/sync');
 * client.send({ actionId: '1', move: { x: 10, y: 20 } });
 * ```
 *
 * @example With ts-proto types
 * ```typescript
 * import { GameCommand, CommandSummary } from './gen/game';
 *
 * const client = new TypedGRPCWSClient<GameCommand, CommandSummary>();
 * client.onMessage = (summary: CommandSummary) => {
 *   console.log(`Executed ${summary.commandsExecuted} commands`);
 * };
 * await client.connect('ws://localhost:8080/ws/v1/commands');
 * client.send({ commandId: '1', commandType: 'move' });
 * client.endSend();
 * ```
 */
class TypedGRPCWSClient {
    constructor(options = {}) {
        /** Called when a typed message is received */
        this.onMessage = () => { };
        /** Called when the stream ends normally */
        this.onStreamEnd = () => { };
        /** Called when the server sends an error */
        this.onError = () => { };
        /** Called when the connection closes */
        this.onClose = () => { };
        /** Called when a ping is received */
        this.onPing = () => { };
        this.client = new grpcws_client_1.GRPCWSClient(options);
        this.setupHandlers();
    }
    /**
     * Connect to a grpcws WebSocket server.
     * @param url The WebSocket URL to connect to
     * @returns Promise that resolves when connected
     */
    connect(url) {
        return this.client.connect(url);
    }
    /**
     * Send a typed message to the server.
     * @param data The typed data payload to send
     */
    send(data) {
        this.client.send(data);
    }
    /**
     * Signal that the client is done sending (half-close).
     */
    endSend() {
        this.client.endSend();
    }
    /**
     * Cancel the stream.
     */
    cancel() {
        this.client.cancel();
    }
    /**
     * Close the WebSocket connection.
     */
    close() {
        this.client.close();
    }
    /**
     * Check if the client is connected.
     */
    get isConnected() {
        return this.client.isConnected;
    }
    /**
     * Get the WebSocket ready state.
     */
    get readyState() {
        return this.client.readyState;
    }
    /**
     * Set up handlers to forward events with proper typing.
     */
    setupHandlers() {
        this.client.onMessage = (data) => {
            // Cast to TOut - the protobuf JSON matches the TypeScript type
            this.onMessage(data);
        };
        this.client.onStreamEnd = () => {
            this.onStreamEnd();
        };
        this.client.onError = (error) => {
            this.onError(error);
        };
        this.client.onClose = () => {
            this.onClose();
        };
        this.client.onPing = (pingId) => {
            this.onPing(pingId);
        };
    }
}
exports.TypedGRPCWSClient = TypedGRPCWSClient;
//# sourceMappingURL=typed-client.js.map